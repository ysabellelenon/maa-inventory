{% extends "maainventory/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/inventory.css' %}">
<style>
/* Strongly-scoped page overrides: target only when the body has the
   `edit-item-page-open` class so no other pages are affected. */
body.edit-item-page-open .content {
  height: auto !important;
  overflow: visible !important;
}
body.edit-item-page-open .inventory-container {
  height: auto !important;
  overflow: visible !important;
}
/* Allow internal elements to scroll normally when needed */
body.edit-item-page-open .inventory-container,
body.edit-item-page-open .inventory-container * {
  -webkit-overflow-scrolling: touch;
}
</style>
{% endblock %}

{% block content %}
  <div class="edit-item-page">
  <div class="page-header inventory-header">
    <div style="display:flex;flex-direction:column;">
      <nav class="breadcrumbs" aria-label="Breadcrumb">
        <a href="{% url 'dashboard' %}">Dashboard</a><span class="sep" aria-hidden="true">&rsaquo;</span>
        <a href="{% url 'inventory' %}">Inventory</a><span class="sep" aria-hidden="true">&rsaquo;</span>
        <span class="active" aria-current="page">{{ item.name }}</span>
      </nav>
      <h2 style="margin-top:6px;">{{ item.name }}</h2>
      <h3 class="item-submeta"><strong>Item Code:</strong> {{ item.code }} &nbsp;•&nbsp; <strong>Category:</strong> {{ item.category|default:"—" }}</h3>
    </div>
    <div style="display:flex;align-items:center;gap:6px;">
      <button class="btn-save-inline" aria-label="Save">
        <img src="{% static 'icons/check.svg' %}" alt="" />
        <span>Save</span>
      </button>
    </div>
  </div>

  <div class="inventory-container">
    <div style="display:flex;gap:20px;align-items:flex-start;flex-wrap:wrap;">
      <div style="flex:1;">
        <div style="display:flex;gap:12px;margin-bottom:12px;flex-wrap:wrap;">
          <img src="{% static 'images/sample-item.jpg' %}" alt="" style="width:140px;max-width:100%;height:100px;border-radius:8px;object-fit:cover;border:1px solid #f3f3f3;">
          <img src="{% static 'images/sample-item.jpg' %}" alt="" style="width:140px;max-width:100%;height:100px;border-radius:8px;object-fit:cover;border:1px solid #f3f3f3;">
          <img src="{% static 'images/sample-item.jpg' %}" alt="" style="width:140px;max-width:100%;height:100px;border-radius:8px;object-fit:cover;border:1px solid #f3f3f3;">
          <div style="width:140px;max-width:100%;height:100px;border-radius:8px;border:1px dashed #e6e6e6;display:flex;align-items:center;justify-content:center;color:#9ca3af;">
            Add Image
          </div>
        </div>

        <div style="background:var(--card-bg);padding:12px;border-radius:8px;margin-bottom:12px;">
        <div style="font-weight:700;margin-bottom:6px;">Description</div>
          <textarea class="panel-textarea description-field" aria-label="Item description">{{ item.desc|default:"" }}</textarea>
        </div>

        <div style="background:var(--card-bg);padding:12px;border-radius:8px;margin-bottom:12px;">
          <div style="font-weight:700;margin-bottom:8px;">Basic Details</div>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;">
            <div>
              <label class="field-label">Item Name</label>
              <input class="panel-input" type="text" value="{{ item.name }}" />
            </div>
            <div>
              <label class="field-label">Base Unit</label>
              <input class="panel-input" type="text" value="{{ item.base_unit|default:'pcs' }}" />
            </div>
            <div>
              <label class="field-label">Category</label>
              <input class="panel-input" type="text" value="{{ item.category|default:'—' }}" />
            </div>
  </div>
  </div>

  <script>
    (function () {
      // add a body-level marker so we can override parent (.content) styles
      // without changing global CSS. Remove on unload to avoid cross-page leaks.
      try {
        document.body.classList.add('edit-item-page-open');
        window.addEventListener('unload', function () {
          document.body.classList.remove('edit-item-page-open');
        });
      } catch (e) {
        // defensive: if document not available for some reason, ignore
      }
    })();
  </script>

        <div style="background:var(--card-bg);padding:12px;border-radius:8px;margin-bottom:12px;">
          <div style="font-weight:700;margin-bottom:8px;">Suppliers</div>
          <div class="supplier-table-wrap" style="overflow:auto;">
            <table class="supplier-table" style="width:100%;border-collapse:collapse;">
              <thead>
                <tr>
                  <th style="text-align:left;padding:8px 10px;color:#6b7280;font-size:13px;">Supplier ID</th>
                  <th style="text-align:left;padding:8px 10px;color:#6b7280;font-size:13px;">Supplier Name</th>
                  <th style="text-align:left;padding:8px 10px;color:#6b7280;font-size:13px;">Price per Unit (OMR)</th>
                  <th style="text-align:left;padding:8px 10px;color:#6b7280;font-size:13px;">Available with Supplier</th>
                  <th style="text-align:left;padding:8px 10px;color:#6b7280;font-size:13px;">Last Purchase Date</th>
                  <th style="text-align:left;padding:8px 10px;color:#6b7280;font-size:13px;">Status</th>
                </tr>
              </thead>
              <tbody>
                {% for s in item_suppliers %}
                <tr>
                  <td style="padding:8px 10px;color:#374151;font-weight:600;">{{ s.id }}</td>
                  <td style="padding:8px 10px;color:#374151;">
                    <a href="#" class="supplier-link">{{ s.name }}</a>
                  </td>
                  <td style="padding:8px 10px;color:#374151;">{{ s.price_per_unit }}</td>
                  <td style="padding:8px 10px;color:#374151;">{{ s.available }}</td>
                  <td style="padding:8px 10px;color:#374151;">{{ s.last_purchase_date }}</td>
                  <td style="padding:8px 10px;"><span class="status-pill {% if s.status == 'Active' %}status-good{% else %}status-under-review{% endif %}">{{ s.status }}</span></td>
                </tr>
                {% empty %}
                <tr><td colspan="6" style="padding:8px 10px;color:#6b7280;">No suppliers found for this item.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <aside style="flex:0 0 360px;min-width:0;max-width:360px;">
        <div style="background:var(--card-bg);padding:12px;border-radius:8px;margin-bottom:12px;">
          <div style="font-weight:700;margin-bottom:8px;">Consumption Overview</div>
          <div style="font-size:20px;font-weight:700;">2,450 pcs <span style="color:green;font-size:12px;">▲ 1.34% vs last month</span></div>
          <div style="height:120px;background:#fff;border-radius:8px;margin-top:8px;border:1px solid #f3f4f6;"></div>
        </div>

        <!-- Location management panel (replaces Product Organization) -->
        <div class="locations-panel" style="background:var(--card-bg);padding:12px;border-radius:8px;margin-bottom:12px;">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <h3 class="locations-title" style="margin:0;font-weight:700;font-size:15px;">Active Locations</h3>
            <div>
              <button class="btn-filter" style="margin-right:8px;padding:6px 10px;">Select All</button>
              <button class="btn-filter" style="padding:6px 10px;">Unselect All</button>
            </div>
          </div>

          <input class="panel-input" placeholder="Search locations" aria-label="Search locations" style="margin-top:12px;margin-bottom:12px;">

          <div class="locations-list" style="max-height:260px;overflow:auto;">
            <div class="location-group">
              <div class="location-group-header" style="font-weight:700;padding:8px 0;border-bottom:1px solid #f3f4f6;">THOUM</div>
              <div class="location-item" style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid #fbfbfb;">
                <div>Thoum Mabella - Kitchen</div>
                <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
              </div>
              <div class="location-item" style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid #fbfbfb;">
                <div>Thoum Al Khuwair - Kitchen</div>
                <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
              </div>
              <div class="location-item" style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid #fbfbfb;">
                <div>Thoum Al Hail - Kitchen</div>
                <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
              </div>
            </div>

            <div class="location-group" style="margin-top:8px;">
              <div class="location-group-header" style="font-weight:700;padding:8px 0;border-bottom:1px solid #f3f4f6;">KUCU</div>
              <div class="location-item" style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid #fbfbfb;">
                <div>Kucu Alkoud New - Kitchen</div>
                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
              </div>
              <div class="location-item" style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid #fbfbfb;">
                <div>Kucu Al Ma'abilah - Kitchen</div>
                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
              </div>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>
  </div>

{% endblock %}


